services:
  sentry-core:
    # We keep 'build: .' for now so you can test immediately without pushing/pulling
    build: .
    image: ghcr.io/ghazeltine/project-sentry:stabilize
    container_name: sentry-core
    restart: unless-stopped
    
    # PRIVILEGES: Required for mounting network drives
    cap_add:
      - SYS_ADMIN
      - DAC_READ_SEARCH
    security_opt:
      - apparmor:unconfined
      
    ports:
      - "8000:8000"
      
    environment:
      - SENTRY_USER=${SENTRY_USER:-admin}
      - SENTRY_PASS=${SENTRY_PASS:-change-this-now}
      - SENTRY_DB_PATH=/data/sentry.db
      
    volumes:
      # PERSISTENCE
      - /mnt/sentry/_db:/data
      
      # STORAGE ACCESS (The All-Seeing Fix)
      # :shared / :rslave allows the container to see mounts happening on the host
      - /mnt/sentry:/mnt/sentry:shared   # For Network Mounts
      - /media:/media:rslave             # For USB Drives (Raspberry Pi default)
      - /mnt:/mnt:rslave                 # For Manual Mounts
      - /run/media:/run/media:rslave     # For some Linux Distros
