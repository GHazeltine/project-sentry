services:
  # 1. THE BRAIN (Sentry App)
  sentry-core:
    build: .
    image: sentry-core:v4
    container_name: sentry_core_v4
    privileged: true
    restart: always
    ports:
      - "8000:8000"
    volumes:
      - .:/app
      - /:/host_fs                     # Map Entire Drive for "God Mode"
      - /media:/media                  # USB Drives
      - /mnt:/mnt                      # Network Drives
      - /dev:/dev                      # Device Access
    devices:
      # - /dev/hailo0:/dev/hailo0      # <--- UNCOMMENT ON PI ONLY
    environment:
      - DATABASE_URL=postgresql://sentry_admin:sentry_secure_pass@sentry-db:5432/sentry_v3
      - PYTHONUNBUFFERED=1
    depends_on:
      - sentry-db

  # 2. THE MEMORY (Enterprise Database)
  sentry-db:
    image: postgres:15-alpine
    container_name: sentry_postgres
    restart: always
    environment:
      POSTGRES_USER: sentry_admin
      POSTGRES_PASSWORD: sentry_secure_pass
      POSTGRES_DB: sentry_v3
    volumes:
      - sentry_pg_data:/var/lib/postgresql/data
    ports:
      - "5432:5432"

volumes:
  sentry_pg_data:
