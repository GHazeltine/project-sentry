version: '3.8'

services:
  sentry-core:
    build: .
    container_name: sentry-core
    restart: unless-stopped
    
    # HARDWARE ACCESS
    privileged: true
    cap_add:
      - SYS_ADMIN
      - DAC_READ_SEARCH
    security_opt:
      - apparmor:unconfined
      
    ports:
      - "8000:8000"
      
    environment:
      - SENTRY_USER=${SENTRY_USER:-admin}
      - SENTRY_PASS=${SENTRY_PASS:-change-this-now}
      - SENTRY_DB_PATH=/data/sentry.db
      
    volumes:
      # CODE MAPPING (Live Updates)
      - .:/app
      
      # DATA PERSISTENCE
      - ./_db:/data
      
      # SYSTEM VISIBILITY
      - /mnt/sentry:/mnt/sentry:shared
      - /media:/media:rslave
      - /mnt:/mnt:rslave
      - /run/media:/run/media:rslave
      - /:/host_fs:rslave
